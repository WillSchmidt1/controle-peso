<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Controle Premium</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { background:#121212; color:white; }
.card { background:#1e1e1e; border:none; border-radius:20px; }
.form-control, .form-select, textarea {
    background:#2c2c2c !important;
    color:white !important;
    border:none !important;
}
.form-control::placeholder, textarea::placeholder { color:#aaa; }
.table { color:white; }
canvas { background:#1e1e1e; border-radius:20px; padding:10px; }
.metric-number { font-size:22px; font-weight:bold; }
.section-title { color:white; }
</style>
</head>
<body>

<div class="container py-4">

<h2 class="text-center mb-4">üèãÔ∏è Controle Premium</h2>

<ul class="nav nav-tabs mb-4">
<li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#dashboard">Dashboard</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#cadastro">Cadastro</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#registros">Registros</button></li>
</ul>

<div class="tab-content">

<!-- DASHBOARD -->
<div class="tab-pane fade show active" id="dashboard">

<div class="row text-center mb-4">
<div class="col-4">
<div>√öltimo Peso</div>
<div id="ultimoPeso" class="metric-number">-</div>
</div>
<div class="col-4">
<div>Varia√ß√£o</div>
<div id="variacaoPeso" class="metric-number">-</div>
</div>
<div class="col-4">
<div>Meta</div>
<div id="metaDisplay" class="metric-number">-</div>
</div>
</div>

<div class="card p-3 mb-3">
<input type="number" id="metaPeso" step="0.1" class="form-control mb-2" placeholder="Meta (kg)">
<button class="btn btn-success w-100" onclick="salvarMeta()">Salvar Meta</button>
</div>

<div class="card p-3 mb-3"><canvas id="graficoPeso"></canvas></div>
<div class="card p-3 mb-3"><canvas id="graficoBebida"></canvas></div>
<div class="card p-3 mb-3"><canvas id="graficoAtividade"></canvas></div>

</div>

<!-- CADASTRO -->
<div class="tab-pane fade" id="cadastro">

<div class="card p-3 mb-3">
<h5 class="section-title">Peso</h5>
<input type="date" id="pesoData" class="form-control mb-2">
<input type="number" id="pesoValor" step="0.1" class="form-control mb-2" placeholder="Peso (kg)">
<button class="btn btn-success w-100" onclick="salvarPeso()">Salvar</button>
</div>

<div class="card p-3 mb-3">
<h5 class="section-title">Atividade F√≠sica</h5>
<input type="date" id="atvData" class="form-control mb-2">
<textarea id="atvDesc" class="form-control mb-2" placeholder="Descri√ß√£o"></textarea>
<button class="btn btn-success w-100" onclick="salvarAtividade()">Salvar</button>
</div>

<div class="card p-3 mb-3">
<h5 class="section-title">Bebida Alco√≥lica</h5>
<input type="datetime-local" id="bebData" class="form-control mb-2">
<input type="number" id="bebQtd" step="0.01" class="form-control mb-2" placeholder="Quantidade (L)">
<select id="bebTipo" class="form-select mb-2">
<option>Cerveja</option>
<option>Vinho</option>
<option>Whisky</option>
</select>
<button class="btn btn-success w-100" onclick="salvarBebida()">Salvar</button>
</div>

</div>

<!-- REGISTROS -->
<div class="tab-pane fade" id="registros">

<div class="card p-3 mb-3">
<h5>Hist√≥rico de Pesos</h5>
<table class="table">
<thead><tr><th>Data</th><th>Peso</th><th>A√ß√µes</th></tr></thead>
<tbody id="listaPesos"></tbody>
</table>
</div>

</div>

</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>

let pesos = JSON.parse(localStorage.getItem("pesos")) || [];
let atividades = JSON.parse(localStorage.getItem("atividades")) || [];
let bebidas = JSON.parse(localStorage.getItem("bebidas")) || [];
let meta = localStorage.getItem("meta");

document.getElementById("pesoData").valueAsDate = new Date();
document.getElementById("atvData").valueAsDate = new Date();
document.getElementById("bebData").value = new Date().toISOString().slice(0,16);
if(meta) document.getElementById("metaPeso").value = meta;

let chartPeso, chartBebida, chartAtividade;

function salvarMeta(){
meta = document.getElementById("metaPeso").value;
localStorage.setItem("meta", meta);
atualizarTudo();
}

function salvarPeso(){
pesos.push({
data: document.getElementById("pesoData").value,
peso: parseFloat(document.getElementById("pesoValor").value)
});
localStorage.setItem("pesos", JSON.stringify(pesos));
atualizarTudo();
}

function salvarAtividade(){
atividades.push({data: document.getElementById("atvData").value});
localStorage.setItem("atividades", JSON.stringify(atividades));
atualizarTudo();
}

function salvarBebida(){
bebidas.push({data: document.getElementById("bebData").value});
localStorage.setItem("bebidas", JSON.stringify(bebidas));
atualizarTudo();
}

function editarPeso(index){
let novo = prompt("Editar peso:", pesos[index].peso);
if(novo){
pesos[index].peso = parseFloat(novo);
localStorage.setItem("pesos", JSON.stringify(pesos));
atualizarTudo();
}
}

function apagarPeso(index){
if(confirm("Deseja apagar este registro?")){
pesos.splice(index,1);
localStorage.setItem("pesos", JSON.stringify(pesos));
atualizarTudo();
}
}

function atualizarLista(){
let lista = document.getElementById("listaPesos");
lista.innerHTML="";

pesos.sort((a,b)=> new Date(a.data) - new Date(b.data));

pesos.forEach((p,i)=>{
lista.innerHTML += `
<tr>
<td>${new Date(p.data).toLocaleDateString()}</td>
<td>${p.peso} kg</td>
<td>
<button class="btn bg-info btn-sm me-1" onclick="editarPeso(${i})">Editar</button>
<button class="btn btn-danger btn-sm" onclick="apagarPeso(${i})">Apagar</button>
</td>
</tr>`;
});
}

function atualizarGraficos(){

let ordenado = [...pesos].sort((a,b)=> new Date(a.data) - new Date(b.data));
let labels = ordenado.map(p=> new Date(p.data).toLocaleDateString());
let dados = ordenado.map(p=> p.peso);
let linhaMeta = meta ? Array(dados.length).fill(meta) : [];

if(chartPeso) chartPeso.destroy();
if(chartBebida) chartBebida.destroy();
if(chartAtividade) chartAtividade.destroy();

chartPeso = new Chart(document.getElementById("graficoPeso"),{
type:"line",
data:{labels:labels,datasets:[
{label:"Peso", data:dados},
{label:"Meta", data:linhaMeta}
]}
});

chartBebida = new Chart(document.getElementById("graficoBebida"),{
type:"bar",
data:{
labels: labels,
datasets:[{
label:"Dias com bebida",
data: labels.map(l=>{
let iso = ordenado.find(p=> new Date(p.data).toLocaleDateString()===l)?.data;
return bebidas.some(b=> new Date(b.data).toLocaleDateString()===l)?1:0;
})
}]
}
});

chartAtividade = new Chart(document.getElementById("graficoAtividade"),{
type:"bar",
data:{
labels: labels,
datasets:[{
label:"Dias com atividade",
data: labels.map(l=>{
return atividades.some(a=> new Date(a.data).toLocaleDateString()===l)?1:0;
})
}]
}
});

}

function atualizarTudo(){

if(pesos.length){
let ordenado = [...pesos].sort((a,b)=> new Date(a.data) - new Date(b.data));
let ultimo = ordenado[ordenado.length-1].peso;
document.getElementById("ultimoPeso").innerText = ultimo+" kg";

if(ordenado.length>1){
let variacao = ultimo - ordenado[ordenado.length-2].peso;
document.getElementById("variacaoPeso").innerText = variacao.toFixed(1)+" kg";
}
}

document.getElementById("metaDisplay").innerText = meta ? meta+" kg" : "-";

atualizarGraficos();
atualizarLista();
}

atualizarTudo();

</script>

</body>
</html>
