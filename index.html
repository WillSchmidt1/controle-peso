<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Controle Premium</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { background:#121212; color:white; }

.card {
    background:#1e1e1e;
    border:none;
    border-radius:20px;
}

.form-control, .form-select, textarea {
    background:#2c2c2c !important;
    color:white !important;
    border:1px solid #444 !important;
}

.form-control::placeholder,
textarea::placeholder {
    color:#bbb !important;
}

label, h5 {
    color:white !important;
}

canvas {
    background:#1e1e1e;
    border-radius:20px;
    padding:10px;
}

.table td, .table th {
    color:white;
}
</style>

<body>

<div class="container py-4">
<h2 class="text-center mb-4">üèãÔ∏è Controle Premium</h2>

<ul class="nav nav-tabs mb-4">
<li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#dashboard">Dashboard</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#cadastro">Cadastro</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#registros">Registros</button></li>
</ul>

<div class="tab-content">

<!-- DASHBOARD -->
<div class="tab-pane fade show active" id="dashboard">
<div class="card p-3 mb-3">
<h5>Meta de Peso</h5>
<input type="number" step="0.1" id="metaPeso" class="form-control mb-2" placeholder="Definir meta (kg)">
<button class="btn btn-warning w-100" onclick="salvarMeta()">Salvar Meta</button>
</div>

<div class="card p-3 mb-3"><canvas id="graficoPeso"></canvas></div>
<div class="card p-3 mb-3"><canvas id="graficoBebida"></canvas></div>
<div class="card p-3 mb-3"><canvas id="graficoAtividade"></canvas></div>

</div>

<!-- CADASTRO -->
<div class="tab-pane fade" id="cadastro">

<div class="card p-3 mb-3">
<h5 class="section-title">Peso</h5>
<input type="date" id="pesoData" class="form-control mb-2">
<input type="number" id="pesoValor" step="0.1" class="form-control mb-2" placeholder="Peso (kg)">
<button class="btn btn-success w-100" onclick="salvarPeso()">Salvar</button>
</div>

<div class="card p-3 mb-3">
<h5 class="section-title">Atividade F√≠sica</h5>
<input type="date" id="atvData" class="form-control mb-2">
<select id="atvTipo" class="form-select mb-2">
<option>Academia</option>
<option>Corrida</option>
<option>Caminhada</option>
</select>
<button class="btn btn-success w-100" onclick="salvarAtividade()">Salvar</button>
</div>

<div class="card p-3 mb-3">
<h5 class="section-title">Bebida Alco√≥lica</h5>
<input type="date" id="bebData" class="form-control mb-2">
<input type="number" id="bebQtd" step="0.01" class="form-control mb-2" placeholder="Quantidade (L)">
<select id="bebTipo" class="form-select mb-2">
<option>Cerveja</option>
<option>Vinho</option>
<option>Whisky</option>
</select>
<button class="btn btn-success w-100" onclick="salvarBebida()">Salvar</button>
</div>

</div>

<!-- REGISTROS -->
<div class="tab-pane fade" id="registros">

<div class="card p-3 mb-3">
<button class="btn btn-primary mb-3" onclick="baixarExcel()">Baixar Excel</button>
<table class="table table-dark table-striped">
<thead>
<tr><th>Data</th><th>Tipo</th><th>Descri√ß√£o</th></tr>
</thead>
<tbody id="listaRegistros"></tbody>
</table>
</div>

</div>

</div>
</div>

<div class="toast-container">
<div id="toastSalvo" class="toast align-items-center text-bg-success border-0">
<div class="d-flex">
<div class="toast-body">Salvo!</div>
<button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>

let pesos = JSON.parse(localStorage.getItem("pesos")) || [];
let atividades = JSON.parse(localStorage.getItem("atividades")) || [];
let bebidas = JSON.parse(localStorage.getItem("bebidas")) || [];
let meta = localStorage.getItem("metaPeso") || null;

document.getElementById("pesoData").valueAsDate = new Date();
document.getElementById("atvData").valueAsDate = new Date();
document.getElementById("bebData").value = new Date().toISOString().slice(0,16);

if(meta){
document.getElementById("metaPeso").value = meta;
}

let chartPeso, chartBebida, chartAtividade;

function salvarMeta(){
meta = document.getElementById("metaPeso").value;
localStorage.setItem("metaPeso", meta);
atualizarGraficos();
}

function salvarPeso(){
pesos.push({
data: document.getElementById("pesoData").value,
peso: parseFloat(document.getElementById("pesoValor").value)
});
localStorage.setItem("pesos", JSON.stringify(pesos));
document.getElementById("pesoValor").value="";
mostrarToast();
atualizarTudo();
}

function salvarAtividade(){
atividades.push({
data: document.getElementById("atvData").value,
desc: document.getElementById("atvTipo").value
});
localStorage.setItem("atividades", JSON.stringify(atividades));
document.getElementById("atvTipo").value="";
mostrarToast();
atualizarTudo();
}

function salvarBebida(){
bebidas.push({
data: document.getElementById("bebData").value,
tipo: document.getElementById("bebTipo").value,
qtd: document.getElementById("bebQtd").value
});
localStorage.setItem("bebidas", JSON.stringify(bebidas));
document.getElementById("bebQtd").value="";
mostrarToast();
atualizarTudo();
}

function atualizarGraficos(){

// 1Ô∏è‚É£ Criar conjunto com TODAS as datas (peso + bebida + atividade)
let datasSet = new Set();

pesos.forEach(p => datasSet.add(p.data));
bebidas.forEach(b => datasSet.add(b.data));
atividades.forEach(a => datasSet.add(a.data));

let todasDatas = Array.from(datasSet).sort((a,b)=> new Date(a) - new Date(b));

// 2Ô∏è‚É£ Alinhar pesos √†s datas
let dadosPeso = todasDatas.map(data=>{
let registro = pesos.find(p => p.data === data);
return registro ? registro.peso : null;
});

// 3Ô∏è‚É£ Marcar dias com bebida (independente de peso)
let dadosBebida = todasDatas.map((data,i)=>{
let temBebida = bebidas.some(b => b.data === data);
return temBebida ? dadosPeso[i] : null;
});

// 4Ô∏è‚É£ Marcar dias com atividade
let dadosAtividade = todasDatas.map((data,i)=>{
let temAtividade = atividades.some(a => a.data === data);
return temAtividade ? dadosPeso[i] : null;
});

// 5Ô∏è‚É£ Linha meta
let linhaMeta = meta ? Array(todasDatas.length).fill(parseFloat(meta)) : [];

// Destruir gr√°ficos antigos
if(chartPeso) chartPeso.destroy();
if(chartBebida) chartBebida.destroy();
if(chartAtividade) chartAtividade.destroy();


// ===== GR√ÅFICO 1 =====
chartPeso = new Chart(graficoPeso,{
type:"line",
data:{
labels:todasDatas,
datasets:[
{label:"Peso", data:dadosPeso},
meta ? {label:"Meta", data:linhaMeta, borderDash:[5,5]} : {}
]
}
});


// ===== GR√ÅFICO 2 =====
chartBebida = new Chart(graficoBebida,{
type:"line",
data:{
labels:todasDatas,
datasets:[
{label:"Peso", data:dadosPeso},
{
label:"Dias com Bebida",
data:dadosBebida,
pointBackgroundColor:"red",
pointRadius:6,
showLine:false
},
meta ? {label:"Meta", data:linhaMeta, borderDash:[5,5]} : {}
]
}
});


// ===== GR√ÅFICO 3 =====
chartAtividade = new Chart(graficoAtividade,{
type:"line",
data:{
labels:todasDatas,
datasets:[
{label:"Peso", data:dadosPeso},
{
label:"Dias com Atividade",
data:dadosAtividade,
pointBackgroundColor:"lime",
pointRadius:6,
showLine:false
},
meta ? {label:"Meta", data:linhaMeta, borderDash:[5,5]} : {}
]
}
});

}

function atualizarLista(){

let lista = document.getElementById("listaRegistros");
lista.innerHTML="";

pesos.forEach((p,i)=>{
lista.innerHTML += `
<tr>
<td>${p.data}</td>
<td>Peso</td>
<td>${p.peso} kg</td>
<td>
<button class="btn btn-info btn-sm" onclick="editar('peso',${i})">Editar</button>
<button class="btn btn-danger btn-sm" onclick="apagar('peso',${i})">Apagar</button>
</td>
</tr>`;
});

atividades.forEach((a,i)=>{
lista.innerHTML += `
<tr>
<td>${a.data}</td>
<td>Atividade</td>
<td>${a.desc}</td>
<td>
<button class="btn btn-info btn-sm" onclick="editar('atividade',${i})">Editar</button>
<button class="btn btn-danger btn-sm" onclick="apagar('atividade',${i})">Apagar</button>
</td>
</tr>`;
});

bebidas.forEach((b,i)=>{
lista.innerHTML += `
<tr>
<td>${b.data}</td>
<td>Bebida</td>
<td>${b.tipo} ${b.qtd}L</td>
<td>
<button class="btn btn-info btn-sm" onclick="editar('bebida',${i})">Editar</button>
<button class="btn btn-danger btn-sm" onclick="apagar('bebida',${i})">Apagar</button>
</td>
</tr>`;
});

}

function apagar(tipo,index){
if(tipo==="peso"){pesos.splice(index,1);localStorage.setItem("pesos",JSON.stringify(pesos));}
if(tipo==="atividade"){atividades.splice(index,1);localStorage.setItem("atividades",JSON.stringify(atividades));}
if(tipo==="bebida"){bebidas.splice(index,1);localStorage.setItem("bebidas",JSON.stringify(bebidas));}
atualizarTudo();
}

function editar(tipo,index){
alert("Edi√ß√£o simples: exclua e registre novamente.\nPr√≥xima vers√£o podemos criar modal premium.");
}

function mostrarToast(){
let toast = new bootstrap.Toast(document.getElementById("toastSalvo"));
toast.show();
}

function atualizarTudo(){
atualizarGraficos();
atualizarLista();
}

atualizarTudo();

</script>


</body>
</html>





