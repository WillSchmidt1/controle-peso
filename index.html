<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Controle Premium</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { background:#121212; color:white; }
.card { background:#1e1e1e; border:none; border-radius:20px; }
.form-control, .form-select, textarea {
background:#2c2c2c !important;
color:white !important;
border:none !important;
}
canvas { background:#1e1e1e; border-radius:20px; padding:10px; }
.section-title { color:white; }
.toast-container { position:fixed; top:20px; right:20px; z-index:9999; }
</style>
</head>
<body>

<div class="container py-4">
<h2 class="text-center mb-4">üèãÔ∏è Controle Premium</h2>

<ul class="nav nav-tabs mb-4">
<li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#dashboard">Dashboard</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#cadastro">Cadastro</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#registros">Registros</button></li>
</ul>

<div class="tab-content">

<!-- DASHBOARD -->
<div class="tab-pane fade show active" id="dashboard">

<div class="card p-3 mb-3"><canvas id="graficoPeso"></canvas></div>
<div class="card p-3 mb-3"><canvas id="graficoBebida"></canvas></div>
<div class="card p-3 mb-3"><canvas id="graficoAtividade"></canvas></div>

</div>

<!-- CADASTRO -->
<div class="tab-pane fade" id="cadastro">

<div class="card p-3 mb-3">
<h5 class="section-title">Peso</h5>
<input type="date" id="pesoData" class="form-control mb-2">
<input type="number" id="pesoValor" step="0.1" class="form-control mb-2" placeholder="Peso (kg)">
<button class="btn btn-success w-100" onclick="salvarPeso()">Salvar</button>
</div>

<div class="card p-3 mb-3">
<h5 class="section-title">Atividade F√≠sica</h5>
<input type="date" id="atvData" class="form-control mb-2">
<textarea id="atvDesc" class="form-control mb-2" placeholder="Descri√ß√£o"></textarea>
<button class="btn btn-success w-100" onclick="salvarAtividade()">Salvar</button>
</div>

<div class="card p-3 mb-3">
<h5 class="section-title">Bebida Alco√≥lica</h5>
<input type="datetime-local" id="bebData" class="form-control mb-2">
<input type="number" id="bebQtd" step="0.01" class="form-control mb-2" placeholder="Quantidade (L)">
<select id="bebTipo" class="form-select mb-2">
<option>Cerveja</option>
<option>Vinho</option>
<option>Whisky</option>
</select>
<button class="btn btn-success w-100" onclick="salvarBebida()">Salvar</button>
</div>

</div>

<!-- REGISTROS -->
<div class="tab-pane fade" id="registros">

<div class="card p-3 mb-3">
<button class="btn btn-primary mb-3" onclick="baixarExcel()">Baixar Excel</button>
<table class="table table-dark table-striped">
<thead>
<tr><th>Data</th><th>Tipo</th><th>Descri√ß√£o</th></tr>
</thead>
<tbody id="listaRegistros"></tbody>
</table>
</div>

</div>

</div>
</div>

<div class="toast-container">
<div id="toastSalvo" class="toast align-items-center text-bg-success border-0">
<div class="d-flex">
<div class="toast-body">Salvo!</div>
<button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>

let pesos = JSON.parse(localStorage.getItem("pesos")) || [];
let atividades = JSON.parse(localStorage.getItem("atividades")) || [];
let bebidas = JSON.parse(localStorage.getItem("bebidas")) || [];

document.getElementById("pesoData").valueAsDate = new Date();
document.getElementById("atvData").valueAsDate = new Date();
document.getElementById("bebData").value = new Date().toISOString().slice(0,16);

let chartPeso, chartBebida, chartAtividade;

function mostrarToast(){
let toast = new bootstrap.Toast(document.getElementById("toastSalvo"));
toast.show();
}

function salvarPeso(){
pesos.push({
data: document.getElementById("pesoData").value,
peso: parseFloat(document.getElementById("pesoValor").value)
});
localStorage.setItem("pesos", JSON.stringify(pesos));
document.getElementById("pesoValor").value="";
mostrarToast();
atualizarTudo();
}

function salvarAtividade(){
atividades.push({
data: document.getElementById("atvData").value,
desc: document.getElementById("atvDesc").value
});
localStorage.setItem("atividades", JSON.stringify(atividades));
document.getElementById("atvDesc").value="";
mostrarToast();
atualizarTudo();
}

function salvarBebida(){
bebidas.push({
data: document.getElementById("bebData").value,
tipo: document.getElementById("bebTipo").value,
qtd: document.getElementById("bebQtd").value
});
localStorage.setItem("bebidas", JSON.stringify(bebidas));
document.getElementById("bebQtd").value="";
mostrarToast();
atualizarTudo();
}

function atualizarGraficos(){

let ordenado = [...pesos].sort((a,b)=> new Date(a.data)-new Date(b.data));
let labels = ordenado.map(p=> new Date(p.data).toLocaleDateString());
let dados = ordenado.map(p=> p.peso);

if(chartPeso) chartPeso.destroy();
if(chartBebida) chartBebida.destroy();
if(chartAtividade) chartAtividade.destroy();

chartPeso = new Chart(graficoPeso,{
type:"line",
data:{labels:labels,datasets:[
{label:"Peso", data:dados}
]}
});

chartBebida = new Chart(graficoBebida,{
type:"line",
data:{labels:labels,datasets:[
{label:"Peso", data:dados},
{
label:"Dias com bebida",
data:ordenado.map(p=> bebidas.some(b=> new Date(b.data).toLocaleDateString()===new Date(p.data).toLocaleDateString())?p.peso:null),
pointBackgroundColor:"red",
showLine:false,
pointRadius:6
}
]}
});

chartAtividade = new Chart(graficoAtividade,{
type:"line",
data:{labels:labels,datasets:[
{label:"Peso", data:dados},
{
label:"Dias com atividade",
data:ordenado.map(p=> atividades.some(a=> new Date(a.data).toLocaleDateString()===new Date(p.data).toLocaleDateString())?p.peso:null),
pointBackgroundColor:"lime",
showLine:false,
pointRadius:6
}
]}
});

}

function atualizarLista(){

let lista = document.getElementById("listaRegistros");
lista.innerHTML="";

pesos.forEach(p=>{
lista.innerHTML += `<tr>
<td>${new Date(p.data).toLocaleDateString()}</td>
<td>Peso</td>
<td>${p.peso} kg</td>
</tr>`;
});

atividades.forEach(a=>{
lista.innerHTML += `<tr>
<td>${new Date(a.data).toLocaleDateString()}</td>
<td>Atividade</td>
<td>${a.desc}</td>
</tr>`;
});

bebidas.forEach(b=>{
lista.innerHTML += `<tr>
<td>${new Date(b.data).toLocaleDateString()}</td>
<td>Bebida</td>
<td>${b.tipo} - ${b.qtd} L</td>
</tr>`;
});

}

function baixarExcel(){

let csv = "Data,Tipo,Descricao\n";

pesos.forEach(p=>{
csv += `${p.data},Peso,${p.peso} kg\n`;
});
atividades.forEach(a=>{
csv += `${a.data},Atividade,${a.desc}\n`;
});
bebidas.forEach(b=>{
csv += `${b.data},Bebida,${b.tipo} ${b.qtd}L\n`;
});

let blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
let link = document.createElement("a");
link.href = URL.createObjectURL(blob);
link.download = "registros_controle.csv";
link.click();
}

function atualizarTudo(){
atualizarGraficos();
atualizarLista();
}

atualizarTudo();

</script>

</body>
</html>
