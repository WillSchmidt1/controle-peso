<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Controle Premium</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { background:#121212; color:white; }
.card { background:#1e1e1e; border:none; border-radius:20px; }
.form-control, .form-select { background:#2c2c2c; color:white; border:none; }
canvas { background:#1e1e1e; border-radius:20px; padding:10px; }
.nav-tabs .nav-link { color:#aaa; }
.nav-tabs .nav-link.active { background:#1e1e1e; color:#fff; border:none; }
.metric-box { text-align:center; }
.metric-number { font-size:24px; font-weight:bold; }
</style>
</head>
<body>

<div class="container py-4">

<h2 class="text-center mb-4">üèãÔ∏è Controle Premium</h2>

<!-- DASHBOARD -->
<div class="row mb-4">
<div class="col-4 metric-box">
<div>√öltimo Peso</div>
<div id="ultimoPeso" class="metric-number">-</div>
</div>
<div class="col-4 metric-box">
<div>Varia√ß√£o</div>
<div id="variacaoPeso" class="metric-number">-</div>
</div>
<div class="col-4 metric-box">
<div>Meta</div>
<div id="metaDisplay" class="metric-number">-</div>
</div>
</div>

<div class="card p-3 mb-4">
<h5>Meta de Peso (kg)</h5>
<div class="input-group">
<input type="number" id="metaPeso" step="0.1" class="form-control">
<button class="btn btn-success" onclick="salvarMeta()">Salvar</button>
</div>
</div>

<ul class="nav nav-tabs mb-3">
<li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#peso">Peso</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#atividade">Atividade</button></li>
<li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#bebida">Bebida</button></li>
</ul>

<div class="tab-content">

<!-- PESO -->
<div class="tab-pane fade show active" id="peso">
<div class="card p-3 mb-3">
<input type="date" id="pesoData" class="form-control mb-2">
<input type="number" step="0.1" id="pesoInput" class="form-control mb-2" placeholder="Peso (kg)">
<button class="btn btn-success w-100" onclick="salvarPeso()">Salvar Peso</button>
</div>
</div>

<!-- ATIVIDADE -->
<div class="tab-pane fade" id="atividade">
<div class="card p-3 mb-3">
<input type="date" id="atvData" class="form-control mb-2">
<textarea id="atvDescricao" class="form-control mb-2" placeholder="Descri√ß√£o"></textarea>
<button class="btn btn-success w-100" onclick="salvarAtividade()">Salvar</button>
</div>
</div>

<!-- BEBIDA -->
<div class="tab-pane fade" id="bebida">
<div class="card p-3 mb-3">
<input type="datetime-local" id="bebDataHora" class="form-control mb-2">
<input type="number" step="0.01" id="bebQtd" class="form-control mb-2" placeholder="Quantidade (L)">
<select id="bebTipo" class="form-select mb-2">
<option>Cerveja</option>
<option>Vinho</option>
<option>Whisky</option>
</select>
<button class="btn btn-success w-100" onclick="salvarBebida()">Salvar</button>
</div>
</div>

</div>

<hr class="my-4">

<div class="card p-3 mb-4"><canvas id="grafico1"></canvas></div>
<div class="card p-3 mb-4"><canvas id="grafico2"></canvas></div>
<div class="card p-3 mb-4"><canvas id="grafico3"></canvas></div>
<div class="card p-3"><canvas id="grafico4"></canvas></div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>

let pesos = JSON.parse(localStorage.getItem("pesos")) || [];
let atividades = JSON.parse(localStorage.getItem("atividades")) || [];
let bebidas = JSON.parse(localStorage.getItem("bebidas")) || [];
let meta = localStorage.getItem("meta") || null;

document.getElementById("pesoData").valueAsDate = new Date();
document.getElementById("atvData").valueAsDate = new Date();
document.getElementById("bebDataHora").value = new Date().toISOString().slice(0,16);
if(meta) document.getElementById("metaPeso").value = meta;

function salvarMeta(){
meta = document.getElementById("metaPeso").value;
localStorage.setItem("meta", meta);
atualizarTudo();
}

function salvarPeso(){
pesos.push({
peso: parseFloat(document.getElementById("pesoInput").value),
data: document.getElementById("pesoData").value
});
localStorage.setItem("pesos", JSON.stringify(pesos));
atualizarTudo();
}

function salvarAtividade(){
atividades.push({data: document.getElementById("atvData").value});
localStorage.setItem("atividades", JSON.stringify(atividades));
atualizarTudo();
}

function salvarBebida(){
bebidas.push({data: document.getElementById("bebDataHora").value});
localStorage.setItem("bebidas", JSON.stringify(bebidas));
atualizarTudo();
}

function atualizarTudo(){

if(pesos.length > 0){
let ultimo = pesos[pesos.length-1].peso;
document.getElementById("ultimoPeso").innerText = ultimo + " kg";

if(pesos.length > 1){
let variacao = ultimo - pesos[pesos.length-2].peso;
document.getElementById("variacaoPeso").innerText = variacao.toFixed(1) + " kg";
}
}

document.getElementById("metaDisplay").innerText = meta ? meta + " kg" : "-";

let datas = pesos.map(p=>p.data);
let valores = pesos.map(p=>p.peso);
let linhaMeta = meta ? Array(valores.length).fill(meta) : [];

document.querySelectorAll("canvas").forEach(c=>c.remove());

document.querySelectorAll(".card canvas").forEach((c,i)=>{
});

["grafico1","grafico2","grafico3","grafico4"].forEach(id=>{
let newCanvas = document.createElement("canvas");
newCanvas.id=id;
document.querySelectorAll(".card")[4 + ["grafico1","grafico2","grafico3","grafico4"].indexOf(id)]
.appendChild(newCanvas);
});

new Chart(document.getElementById("grafico1"),{
type:"line",
data:{labels:datas,datasets:[
{label:"Peso", data:valores},
{label:"Meta", data:linhaMeta}
]}
});

new Chart(document.getElementById("grafico2"),{
type:"scatter",
data:{datasets:[
{label:"Peso", data:pesos.map(p=>({x:p.data,y:p.peso}))},
{label:"Dias com bebida", data:bebidas.map(b=>{
let p = pesos.find(p=>p.data===b.data.split("T")[0]);
return p?{x:p.data,y:p.peso}:null;
}).filter(x=>x)}
]}
});

new Chart(document.getElementById("grafico3"),{
type:"scatter",
data:{datasets:[
{label:"Peso", data:pesos.map(p=>({x:p.data,y:p.peso}))},
{label:"Dias com atividade", data:atividades.map(a=>{
let p = pesos.find(p=>p.data===a.data);
return p?{x:p.data,y:p.peso}:null;
}).filter(x=>x)}
]}
});

new Chart(document.getElementById("grafico4"),{
type:"line",
data:{labels:datas,datasets:[
{label:"Peso", data:valores},
{label:"Meta", data:linhaMeta}
]}
});

}

atualizarTudo();

</script>

</body>
</html>
